<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Return the global onsets of an object — Fcontrasts • fmrireg</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Return the global onsets of an object — Fcontrasts"><meta name="description" content="Convert relative onset times to global (cumulative) onset times across runs. Global onsets
are defined as cumulative time over runs, meaning they do not reset to zero for each run.
This is useful for:
Converting run-specific onsets to experiment-wide timings
Aligning events across multiple runs
Computing temporal distances between events in different runs


Split a dataset into manageable chunks for processing. This is particularly useful
for parallel processing of large fMRI datasets. Chunks can be created either by run
(runwise=TRUE) or by dividing the data into a specified number of pieces. Each chunk
contains a subset of the data and metadata about its position in the full dataset.
Extract the onset times of events from a model object. Onsets represent the timing of
experimental events in an fMRI design, typically in seconds from the start of each run.
These times are used to:
Create regressors by convolving with HRF
Verify event timing in the design
Analyze temporal patterns of events


Extract the duration of events from a model object. Durations represent how long each
event lasts in an fMRI design, typically in seconds. These are important for:
Modeling block designs where stimuli have non-zero duration
Creating accurate HRF convolutions for extended events
Distinguishing between brief and sustained neural activity


Get the sampling times for a regressor or sampling frame. These times represent when
fMRI data was acquired and can be either relative (within each run) or global
(cumulative across runs). Sampling times are used to:
Evaluate regressors at scan acquisition times
Align model predictions with data collection
Convert between TR-based and time-based representations


Split a vector or matrix of values into separate pieces based on block/run IDs.
This function is useful for:
Separating data into individual runs
Processing blocks independently
Analyzing run-specific patterns


Get the block or run number associated with each scan/timepoint in the dataset.
Block indices are used to:
Track which scans belong to which runs
Split data by experimental blocks
Align events with their corresponding runs
Apply run-specific processing


Get the number of scans or timepoints in each block/run of the dataset. Block lengths
are used to:
Define the temporal structure of the experiment by specifying scan counts and timing per run
Allocate memory for data matrices by pre-allocating arrays based on scan counts
Validate data dimensions across runs by checking against expected lengths
Calculate global timing information by computing cumulative timing across runs


Create F-contrasts to test for overall effects of model terms. F-contrasts are used to:
categorical
Test for any effect of a categorical predictor

basis
Compare multiple basis functions simultaneously

nonlinear
Test for nonlinear effects of continuous predictors

overall
Evaluate overall significance of model terms



"><meta property="og:description" content="Convert relative onset times to global (cumulative) onset times across runs. Global onsets
are defined as cumulative time over runs, meaning they do not reset to zero for each run.
This is useful for:
Converting run-specific onsets to experiment-wide timings
Aligning events across multiple runs
Computing temporal distances between events in different runs


Split a dataset into manageable chunks for processing. This is particularly useful
for parallel processing of large fMRI datasets. Chunks can be created either by run
(runwise=TRUE) or by dividing the data into a specified number of pieces. Each chunk
contains a subset of the data and metadata about its position in the full dataset.
Extract the onset times of events from a model object. Onsets represent the timing of
experimental events in an fMRI design, typically in seconds from the start of each run.
These times are used to:
Create regressors by convolving with HRF
Verify event timing in the design
Analyze temporal patterns of events


Extract the duration of events from a model object. Durations represent how long each
event lasts in an fMRI design, typically in seconds. These are important for:
Modeling block designs where stimuli have non-zero duration
Creating accurate HRF convolutions for extended events
Distinguishing between brief and sustained neural activity


Get the sampling times for a regressor or sampling frame. These times represent when
fMRI data was acquired and can be either relative (within each run) or global
(cumulative across runs). Sampling times are used to:
Evaluate regressors at scan acquisition times
Align model predictions with data collection
Convert between TR-based and time-based representations


Split a vector or matrix of values into separate pieces based on block/run IDs.
This function is useful for:
Separating data into individual runs
Processing blocks independently
Analyzing run-specific patterns


Get the block or run number associated with each scan/timepoint in the dataset.
Block indices are used to:
Track which scans belong to which runs
Split data by experimental blocks
Align events with their corresponding runs
Apply run-specific processing


Get the number of scans or timepoints in each block/run of the dataset. Block lengths
are used to:
Define the temporal structure of the experiment by specifying scan counts and timing per run
Allocate memory for data matrices by pre-allocating arrays based on scan counts
Validate data dimensions across runs by checking against expected lengths
Calculate global timing information by computing cumulative timing across runs


Create F-contrasts to test for overall effects of model terms. F-contrasts are used to:
categorical
Test for any effect of a categorical predictor

basis
Compare multiple basis functions simultaneously

nonlinear
Test for nonlinear effects of continuous predictors

overall
Evaluate overall significance of model terms



"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fmrireg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/Overview.html">Package Overview</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/a_05_contrasts.html">Contrasts</a></li>
    <li><a class="dropdown-item" href="../articles/a_08_simulation.html">Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/a_09_linear_model.html">Linear Modeling</a></li>
    <li><a class="dropdown-item" href="../articles/a_10_dataset.html">Dataset Management</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Resources</h6></li>
    <li><a class="dropdown-item" href="../articles/benchmark_datasets.html">Benchmark Datasets</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/bbuchsbaum/fmrireg/releases/tag/v0.1.0">Version 0.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbuchsbaum/fmrireg/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Return the global onsets of an object</h1>
      <small class="dont-index">Source: <a href="https://github.com/bbuchsbaum/fmrireg/blob/master/R/all_generic.R" class="external-link"><code>R/all_generic.R</code></a></small>
      <div class="d-none name"><code>Fcontrasts.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Convert relative onset times to global (cumulative) onset times across runs. Global onsets
are defined as cumulative time over runs, meaning they do not reset to zero for each run.
This is useful for:</p><ul><li><p>Converting run-specific onsets to experiment-wide timings</p></li>
<li><p>Aligning events across multiple runs</p></li>
<li><p>Computing temporal distances between events in different runs</p></li>
</ul><p>Split a dataset into manageable chunks for processing. This is particularly useful
for parallel processing of large fMRI datasets. Chunks can be created either by run
(runwise=TRUE) or by dividing the data into a specified number of pieces. Each chunk
contains a subset of the data and metadata about its position in the full dataset.</p>
<p>Extract the onset times of events from a model object. Onsets represent the timing of
experimental events in an fMRI design, typically in seconds from the start of each run.
These times are used to:</p><ul><li><p>Create regressors by convolving with HRF</p></li>
<li><p>Verify event timing in the design</p></li>
<li><p>Analyze temporal patterns of events</p></li>
</ul><p>Extract the duration of events from a model object. Durations represent how long each
event lasts in an fMRI design, typically in seconds. These are important for:</p><ul><li><p>Modeling block designs where stimuli have non-zero duration</p></li>
<li><p>Creating accurate HRF convolutions for extended events</p></li>
<li><p>Distinguishing between brief and sustained neural activity</p></li>
</ul><p>Get the sampling times for a regressor or sampling frame. These times represent when
fMRI data was acquired and can be either relative (within each run) or global
(cumulative across runs). Sampling times are used to:</p><ul><li><p>Evaluate regressors at scan acquisition times</p></li>
<li><p>Align model predictions with data collection</p></li>
<li><p>Convert between TR-based and time-based representations</p></li>
</ul><p>Split a vector or matrix of values into separate pieces based on block/run IDs.
This function is useful for:</p><ul><li><p>Separating data into individual runs</p></li>
<li><p>Processing blocks independently</p></li>
<li><p>Analyzing run-specific patterns</p></li>
</ul><p>Get the block or run number associated with each scan/timepoint in the dataset.
Block indices are used to:</p><ul><li><p>Track which scans belong to which runs</p></li>
<li><p>Split data by experimental blocks</p></li>
<li><p>Align events with their corresponding runs</p></li>
<li><p>Apply run-specific processing</p></li>
</ul><p>Get the number of scans or timepoints in each block/run of the dataset. Block lengths
are used to:</p><ul><li><p>Define the temporal structure of the experiment by specifying scan counts and timing per run</p></li>
<li><p>Allocate memory for data matrices by pre-allocating arrays based on scan counts</p></li>
<li><p>Validate data dimensions across runs by checking against expected lengths</p></li>
<li><p>Calculate global timing information by computing cumulative timing across runs</p></li>
</ul><p>Create F-contrasts to test for overall effects of model terms. F-contrasts are used to:</p><dl><dt>categorical</dt>
<dd><p>Test for any effect of a categorical predictor</p></dd>

<dt>basis</dt>
<dd><p>Compare multiple basis functions simultaneously</p></dd>

<dt>nonlinear</dt>
<dd><p>Test for nonlinear effects of continuous predictors</p></dd>

<dt>overall</dt>
<dd><p>Evaluate overall significance of model terms</p></dd>


</dl></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Fcontrasts</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>The model term to generate contrasts for (typically an event_term or event_model)</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to methods. Common arguments include:</p><dl><dt>basis</dt>
<dd><p>Character; type of basis functions used</p></dd>

<dt>nbasis</dt>
<dd><p>Integer; number of basis functions</p></dd>

<dt>exclude</dt>
<dd><p>Character vector of conditions to exclude</p></dd>


</dl></dd>


<dt id="arg-onsets">onsets<a class="anchor" aria-label="anchor" href="#arg-onsets"></a></dt>
<dd><p>A numeric vector of relative onset times within each run/block</p></dd>


<dt id="arg-nchunks">nchunks<a class="anchor" aria-label="anchor" href="#arg-nchunks"></a></dt>
<dd><p>Integer; number of chunks to create (ignored if runwise=TRUE)</p></dd>


<dt id="arg-blockids">blockids<a class="anchor" aria-label="anchor" href="#arg-blockids"></a></dt>
<dd><p>Numeric vector specifying which blocks/runs to include (optional)</p></dd>


<dt id="arg-global">global<a class="anchor" aria-label="anchor" href="#arg-global"></a></dt>
<dd><p>Logical; if TRUE, return cumulative times across runs (default: FALSE)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A numeric vector of global onset times where:</p><ul><li><p>Each onset is adjusted by the cumulative duration of previous runs</p></li>
<li><p>Times are in the same units as the input onsets (typically seconds)</p></li>
<li><p>NA is returned for onsets that exceed their block duration</p></li>
</ul><p>An iterator object that yields data chunks, where each chunk contains:</p><dl><dt>data</dt>
<dd><p>Matrix of data values for this chunk</p></dd>

<dt>chunk_num</dt>
<dd><p>Index of this chunk</p></dd>

<dt>voxel_ind</dt>
<dd><p>Indices of voxels in this chunk</p></dd>

<dt>row_ind</dt>
<dd><p>Indices of timepoints in this chunk</p></dd>


</dl><p>A numeric vector of onset times in seconds, where:</p><ul><li><p>Each value represents the start time of an event</p></li>
<li><p>Times are relative to the start of each run</p></li>
<li><p>Order matches the original event sequence</p></li>
</ul><p>A numeric vector of durations in seconds, where:</p><ul><li><p>Each value represents how long an event lasts</p></li>
<li><p>Zero values indicate instantaneous events</p></li>
<li><p>Order matches the corresponding event sequence</p></li>
</ul><p>A numeric vector of sampling times in seconds, where:</p><ul><li><p>Each value represents a scan acquisition time</p></li>
<li><p>Times account for TR (repetition time) spacing</p></li>
<li><p>If global=FALSE, times reset at the start of each run</p></li>
<li><p>If global=TRUE, times accumulate across runs</p></li>
</ul><p>A list where each element contains data from one block:</p><ul><li><p>List length equals number of blocks</p></li>
<li><p>Each element contains values from one block</p></li>
<li><p>Order matches the original block sequence</p></li>
</ul><p>A numeric vector where:</p><ul><li><p>Each element is the block/run ID for that scan</p></li>
<li><p>IDs are sequential integers starting from 1</p></li>
<li><p>Length matches the total number of scans</p></li>
</ul><p>A numeric vector where:</p><ul><li><p>Each element is the number of scans in a block or run</p></li>
<li><p>Length equals the number of blocks/runs</p></li>
<li><p>Values are positive integers</p></li>
</ul><p>A list of contrast specifications where each contains:</p><dl><dt>weights</dt>
<dd><p>Matrix of contrast weights</p></dd>

<dt>term</dt>
<dd><p>The model term being tested</p></dd>

<dt>name</dt>
<dd><p>Descriptive name for the contrast</p></dd>

<dt>df</dt>
<dd><p>Degrees of freedom for the contrast</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame()</a></code>, <code><a href="https://rdrr.io/pkg/fmridesign/man/event_model.html" class="external-link">event_model()</a></code>
Return a set of data chunks</p>
<p><code><a href="https://bbuchsbaum.github.io/fmridataset/reference/matrix_dataset.html" class="external-link">matrix_dataset()</a></code>, <code><a href="https://bbuchsbaum.github.io/fmridataset/reference/fmri_dataset.html" class="external-link">fmri_dataset()</a></code>, <code><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach::foreach()</a></code>
Get event onsets from an object</p>
<p><code><a href="https://rdrr.io/pkg/fmridesign/man/event_term.html" class="external-link">event_term()</a></code>, <code><a href="https://rdrr.io/pkg/fmridesign/man/event_model.html" class="external-link">event_model()</a></code>, <code><a href="https://bbuchsbaum.github.io/fmrihrf/reference/global_onsets.html" class="external-link">global_onsets()</a></code>
Get event durations from an object</p>
<p><code>onsets()</code>, <code><a href="https://rdrr.io/pkg/fmridesign/man/event_term.html" class="external-link">event_term()</a></code>
Extract sampling times</p>
<p><code><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame()</a></code>, <code><a href="https://bbuchsbaum.github.io/fmrihrf/reference/regressor.html" class="external-link">regressor()</a></code>, <code><a href="https://bbuchsbaum.github.io/fmrihrf/reference/global_onsets.html" class="external-link">global_onsets()</a></code>
Split variables by block ID</p>
<p><code><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame()</a></code>, <code><a href="https://bbuchsbaum.github.io/fmrihrf/reference/blockids.html" class="external-link">blockids()</a></code>, <code><a href="https://bbuchsbaum.github.io/fmrihrf/reference/blocklens.html" class="external-link">blocklens()</a></code>
Get block/run indices</p>
<p><code><a href="https://bbuchsbaum.github.io/fmrihrf/reference/blocklens.html" class="external-link">blocklens()</a></code>, <code><a href="https://rdrr.io/pkg/fmridesign/man/split_by_block.html" class="external-link">split_by_block()</a></code>, <code><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame()</a></code>
Get block/run lengths</p>
<p><code><a href="https://bbuchsbaum.github.io/fmrihrf/reference/blockids.html" class="external-link">blockids()</a></code>, <code><a href="https://rdrr.io/pkg/fmridesign/man/split_by_block.html" class="external-link">split_by_block()</a></code>, <code><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame()</a></code>
Generate F-contrasts for a model term</p>
<p><code><a href="https://rdrr.io/pkg/fmridesign/man/event_model.html" class="external-link">event_model()</a></code>, <code><a href="https://rdrr.io/pkg/fmridesign/man/contrast_weights.html" class="external-link">contrast_weights()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Create a sampling frame with three runs</span></span></span>
<span class="r-in"><span><span class="va">sframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  blocklens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span>,  <span class="co"># 100 scans per run</span></span></span>
<span class="r-in"><span>  TR <span class="op">=</span> <span class="fl">2</span>                         <span class="co"># 2 seconds per scan</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define events in each run</span></span></span>
<span class="r-in"><span><span class="va">run_onsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>     <span class="co"># Events at 10s, 20s, 30s</span></span></span>
<span class="r-in"><span><span class="va">run_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>           <span class="co"># One event per run</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Convert to global onsets</span></span></span>
<span class="r-in"><span><span class="va">global_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/global_onsets.html" class="external-link">global_onsets</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">sframe</span>,</span></span>
<span class="r-in"><span>  onsets <span class="op">=</span> <span class="va">run_onsets</span>,</span></span>
<span class="r-in"><span>  blockids <span class="op">=</span> <span class="va">run_ids</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Returns: c(10, 220, 430)</span></span></span>
<span class="r-in"><span><span class="co"># Because:</span></span></span>
<span class="r-in"><span><span class="co">#  - Run 1: 10s</span></span></span>
<span class="r-in"><span><span class="co">#  - Run 2: 20s + (100 scans * 2s) = 220s</span></span></span>
<span class="r-in"><span><span class="co">#  - Run 3: 30s + (200 scans * 2s) = 430s</span></span></span>
<span class="r-in"><span><span class="co"># Create a simple matrix dataset</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span>, <span class="fl">100</span>, <span class="fl">1000</span><span class="op">)</span>  <span class="co"># 100 timepoints, 1000 voxels</span></span></span>
<span class="r-in"><span><span class="va">dset</span> <span class="op">&lt;-</span> <span class="fu">fmridataset</span><span class="fu">::</span><span class="fu"><a href="https://bbuchsbaum.github.io/fmridataset/reference/matrix_dataset.html" class="external-link">matrix_dataset</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">X</span>, </span></span>
<span class="r-in"><span>  TR <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  run_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span>  <span class="co"># Two runs of 50 timepoints each</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create chunks by run</span></span></span>
<span class="r-in"><span><span class="va">run_chunks</span> <span class="op">&lt;-</span> <span class="fu">fmridataset</span><span class="fu">::</span><span class="fu"><a href="https://bbuchsbaum.github.io/fmridataset/reference/data_chunks.html" class="external-link">data_chunks</a></span><span class="op">(</span><span class="va">dset</span>, runwise <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Process each run chunk</span></span></span>
<span class="r-in"><span><span class="fu">foreach</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span>chunk <span class="op">=</span> <span class="va">run_chunks</span><span class="op">)</span> <span class="op">%do%</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># chunk$data contains the data for one run</span></span></span>
<span class="r-in"><span>  <span class="co"># chunk$row_ind shows which timepoints are included</span></span></span>
<span class="r-in"><span>  <span class="va">mean_signal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in foreach::foreach(chunk = run_chunks) %do% {    mean_signal &lt;- colMeans(chunk$data)}:</span> could not find function "%do%"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create arbitrary number of chunks</span></span></span>
<span class="r-in"><span><span class="va">vox_chunks</span> <span class="op">&lt;-</span> <span class="fu">fmridataset</span><span class="fu">::</span><span class="fu"><a href="https://bbuchsbaum.github.io/fmridataset/reference/data_chunks.html" class="external-link">data_chunks</a></span><span class="op">(</span><span class="va">dset</span>, nchunks <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Process chunks in parallel</span></span></span>
<span class="r-in"><span><span class="fu">foreach</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span>chunk <span class="op">=</span> <span class="va">vox_chunks</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># chunk$data contains subset of voxels</span></span></span>
<span class="r-in"><span>  <span class="co"># chunk$voxel_ind shows which voxels are included</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">$</span><span class="va">data</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in foreach::foreach(chunk = vox_chunks) %dopar% {    apply(chunk$data, 2, sd)}:</span> could not find function "%dopar%"</span>
<span class="r-in"><span><span class="co"># Create event data with multiple conditions</span></span></span>
<span class="r-in"><span><span class="va">event_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"face"</span>, <span class="st">"house"</span>, <span class="st">"face"</span>, <span class="st">"house"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  onsets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  run <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create sampling frame</span></span></span>
<span class="r-in"><span><span class="va">sframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span>blocklens <span class="op">=</span> <span class="fl">50</span>, TR <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create event term</span></span></span>
<span class="r-in"><span><span class="va">eterm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fmridesign/man/event_term.html" class="external-link">event_term</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="va">event_data</span><span class="op">$</span><span class="va">condition</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  onsets <span class="op">=</span> <span class="va">event_data</span><span class="op">$</span><span class="va">onsets</span>,</span></span>
<span class="r-in"><span>  blockids <span class="op">=</span> <span class="va">event_data</span><span class="op">$</span><span class="va">run</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get onsets from term</span></span></span>
<span class="r-in"><span><span class="va">onset_times</span> <span class="op">&lt;-</span> <span class="fu">onsets</span><span class="op">(</span><span class="va">eterm</span><span class="op">)</span>  <span class="co"># Returns: c(1, 10, 20, 30)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create and get onsets from event model</span></span></span>
<span class="r-in"><span><span class="va">evmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fmridesign/man/event_model.html" class="external-link">event_model</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">onsets</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/fmridesign/man/hrf.html" class="external-link">hrf</a></span><span class="op">(</span><span class="va">condition</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">event_data</span>,</span></span>
<span class="r-in"><span>  block <span class="op">=</span> <span class="op">~</span><span class="va">run</span>,</span></span>
<span class="r-in"><span>  sampling_frame <span class="op">=</span> <span class="va">sframe</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">model_onsets</span> <span class="op">&lt;-</span> <span class="fu">onsets</span><span class="op">(</span><span class="va">evmodel</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in UseMethod("onsets"):</span> no applicable method for 'onsets' applied to an object of class "c('event_model', 'list')"</span>
<span class="r-in"><span><span class="co"># Create event data with varying durations</span></span></span>
<span class="r-in"><span><span class="va">event_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"block"</span>, <span class="st">"event"</span>, <span class="st">"block"</span>, <span class="st">"event"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  onsets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  durations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">0</span>, <span class="fl">8</span>, <span class="fl">0</span><span class="op">)</span>,  <span class="co"># 8s blocks and instantaneous events</span></span></span>
<span class="r-in"><span>  run <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create event term</span></span></span>
<span class="r-in"><span><span class="va">eterm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fmridesign/man/event_term.html" class="external-link">event_term</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="va">event_data</span><span class="op">$</span><span class="va">condition</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  onsets <span class="op">=</span> <span class="va">event_data</span><span class="op">$</span><span class="va">onsets</span>,</span></span>
<span class="r-in"><span>  durations <span class="op">=</span> <span class="va">event_data</span><span class="op">$</span><span class="va">durations</span>,</span></span>
<span class="r-in"><span>  blockids <span class="op">=</span> <span class="va">event_data</span><span class="op">$</span><span class="va">run</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get durations from term</span></span></span>
<span class="r-in"><span><span class="va">dur</span> <span class="op">&lt;-</span> <span class="fu">durations</span><span class="op">(</span><span class="va">eterm</span><span class="op">)</span>  <span class="co"># Returns: c(8, 0, 8, 0)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in UseMethod("durations"):</span> no applicable method for 'durations' applied to an object of class "c('event_term', 'event_seq')"</span>
<span class="r-in"><span><span class="co"># Create a sampling frame with multiple runs</span></span></span>
<span class="r-in"><span><span class="va">sframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  blocklens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span>,  <span class="co"># 100 scans per run</span></span></span>
<span class="r-in"><span>  TR <span class="op">=</span> <span class="fl">2</span>,                        <span class="co"># 2 seconds per scan</span></span></span>
<span class="r-in"><span>  start_time <span class="op">=</span> <span class="fl">0</span>                 <span class="co"># Start at time 0</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get relative sampling times (reset each run)</span></span></span>
<span class="r-in"><span><span class="va">rel_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/samples.html" class="external-link">samples</a></span><span class="op">(</span><span class="va">sframe</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># First few times: 0, 2, 4, 6, ... (resets each run)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get global sampling times (cumulative)</span></span></span>
<span class="r-in"><span><span class="va">glob_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/samples.html" class="external-link">samples</a></span><span class="op">(</span><span class="va">sframe</span>, global <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Shows: 0, 2, 4, ..., 198, 200, 202, ..., 598</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get times for specific runs</span></span></span>
<span class="r-in"><span><span class="va">run2_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/samples.html" class="external-link">samples</a></span><span class="op">(</span><span class="va">sframe</span>, blockids <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Times for second run only</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create regressor and get its sampling times</span></span></span>
<span class="r-in"><span><span class="va">event_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  onsets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  run <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/regressor.html" class="external-link">regressor</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  onsets <span class="op">=</span> <span class="va">event_data</span><span class="op">$</span><span class="va">onsets</span>,</span></span>
<span class="r-in"><span>  sampling_frame <span class="op">=</span> <span class="va">sframe</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in regressor(onsets = event_data$onsets, sampling_frame = sframe):</span> unused argument (sampling_frame = sframe)</span>
<span class="r-in"><span><span class="va">reg_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/samples.html" class="external-link">samples</a></span><span class="op">(</span><span class="va">reg</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'reg' not found</span>
<span class="r-in"><span><span class="co"># Create a sampling frame with multiple runs</span></span></span>
<span class="r-in"><span><span class="va">sframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  blocklens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span>,  <span class="co"># 3 runs of 50 scans each</span></span></span>
<span class="r-in"><span>  TR <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create some example data</span></span></span>
<span class="r-in"><span><span class="va">data_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">150</span><span class="op">)</span>  <span class="co"># 150 values (50 per run)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Split data by run</span></span></span>
<span class="r-in"><span><span class="va">run_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fmridesign/man/split_by_block.html" class="external-link">split_by_block</a></span><span class="op">(</span><span class="va">sframe</span>, <span class="va">data_values</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in UseMethod("split_by_block"):</span> no applicable method for 'split_by_block' applied to an object of class "sampling_frame"</span>
<span class="r-in"><span><span class="co"># Returns list with 3 elements, each containing 50 values</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create matrix dataset</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">150</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span>, <span class="fl">150</span>, <span class="fl">10</span><span class="op">)</span>  <span class="co"># 150 timepoints, 10 voxels</span></span></span>
<span class="r-in"><span><span class="va">dset</span> <span class="op">&lt;-</span> <span class="fu">fmridataset</span><span class="fu">::</span><span class="fu"><a href="https://bbuchsbaum.github.io/fmridataset/reference/matrix_dataset.html" class="external-link">matrix_dataset</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">X</span>,</span></span>
<span class="r-in"><span>  TR <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  run_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Split matrix data by run</span></span></span>
<span class="r-in"><span><span class="va">run_matrices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fmridesign/man/split_by_block.html" class="external-link">split_by_block</a></span><span class="op">(</span><span class="va">dset</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in UseMethod("split_by_block"):</span> no applicable method for 'split_by_block' applied to an object of class "c('matrix_dataset', 'fmri_dataset', 'list')"</span>
<span class="r-in"><span><span class="co"># Returns list with 3 matrices, each 50 x 10</span></span></span>
<span class="r-in"><span><span class="co"># Create a sampling frame with multiple runs</span></span></span>
<span class="r-in"><span><span class="va">sframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  blocklens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">50</span><span class="op">)</span>,  <span class="co"># Different length runs</span></span></span>
<span class="r-in"><span>  TR <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get block IDs for all scans</span></span></span>
<span class="r-in"><span><span class="va">block_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/blockids.html" class="external-link">blockids</a></span><span class="op">(</span><span class="va">sframe</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Returns: c(1,1,...,1, 2,2,...,2, 3,3,...,3)</span></span></span>
<span class="r-in"><span><span class="co"># 50 ones, 75 twos, 50 threes</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create a matrix dataset</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">175</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span>, <span class="fl">175</span>, <span class="fl">10</span><span class="op">)</span>  <span class="co"># 175 timepoints (50+75+50), 10 voxels</span></span></span>
<span class="r-in"><span><span class="va">dset</span> <span class="op">&lt;-</span> <span class="fu">fmridataset</span><span class="fu">::</span><span class="fu"><a href="https://bbuchsbaum.github.io/fmridataset/reference/matrix_dataset.html" class="external-link">matrix_dataset</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">X</span>,</span></span>
<span class="r-in"><span>  TR <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  run_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note: blockids method for matrix_dataset is in the fmridataset package</span></span></span>
<span class="r-in"><span><span class="co"># To get block IDs from a dataset, ensure fmridataset is loaded</span></span></span>
<span class="r-in"><span><span class="co"># Create a sampling frame with varying run lengths</span></span></span>
<span class="r-in"><span><span class="va">sframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  blocklens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">150</span>, <span class="fl">100</span><span class="op">)</span>,  <span class="co"># Different length runs</span></span></span>
<span class="r-in"><span>  TR <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get number of scans per run</span></span></span>
<span class="r-in"><span><span class="va">run_lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/blocklens.html" class="external-link">blocklens</a></span><span class="op">(</span><span class="va">sframe</span><span class="op">)</span>  <span class="co"># Returns: c(100, 150, 100)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use block lengths to create a dataset</span></span></span>
<span class="r-in"><span><span class="va">total_scans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">run_lengths</span><span class="op">)</span>  <span class="co"># 350 total timepoints</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">total_scans</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span>, <span class="va">total_scans</span>, <span class="fl">10</span><span class="op">)</span>  <span class="co"># 10 voxels</span></span></span>
<span class="r-in"><span><span class="va">dset</span> <span class="op">&lt;-</span> <span class="fu">fmridataset</span><span class="fu">::</span><span class="fu"><a href="https://bbuchsbaum.github.io/fmridataset/reference/matrix_dataset.html" class="external-link">matrix_dataset</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">X</span>,</span></span>
<span class="r-in"><span>  TR <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  run_length <span class="op">=</span> <span class="va">run_lengths</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Verify block lengths in dataset</span></span></span>
<span class="r-in"><span><span class="va">dset_lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/blocklens.html" class="external-link">blocklens</a></span><span class="op">(</span><span class="va">dset</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in UseMethod("blocklens"):</span> no applicable method for 'blocklens' applied to an object of class "c('matrix_dataset', 'fmri_dataset', 'list')"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use lengths to create time vectors for each run</span></span></span>
<span class="r-in"><span><span class="va">time_vectors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">run_lengths</span>, <span class="kw">function</span><span class="op">(</span><span class="va">len</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, by <span class="op">=</span> <span class="fl">2</span>, length.out <span class="op">=</span> <span class="va">len</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Create event data with multiple conditions</span></span></span>
<span class="r-in"><span><span class="va">event_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">1.2</span>, <span class="fl">0.9</span>, <span class="fl">1.1</span>, <span class="fl">0.7</span>, <span class="fl">1.3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  onsets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  run <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create sampling frame</span></span></span>
<span class="r-in"><span><span class="va">sframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span>blocklens <span class="op">=</span> <span class="fl">60</span>, TR <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create event model with multiple terms</span></span></span>
<span class="r-in"><span><span class="va">evmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fmridesign/man/event_model.html" class="external-link">event_model</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">onsets</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/fmridesign/man/hrf.html" class="external-link">hrf</a></span><span class="op">(</span><span class="va">condition</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/fmridesign/man/hrf.html" class="external-link">hrf</a></span><span class="op">(</span><span class="va">rt</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">event_data</span>,</span></span>
<span class="r-in"><span>  block <span class="op">=</span> <span class="op">~</span><span class="va">run</span>,</span></span>
<span class="r-in"><span>  sampling_frame <span class="op">=</span> <span class="va">sframe</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get F-contrast for main effect of condition</span></span></span>
<span class="r-in"><span><span class="va">cond_contrast</span> <span class="op">&lt;-</span> <span class="fu">Fcontrasts</span><span class="op">(</span><span class="va">evmodel</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in UseMethod("Fcontrasts"):</span> no applicable method for 'Fcontrasts' applied to an object of class "c('event_model', 'list')"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create model with multiple basis functions</span></span></span>
<span class="r-in"><span><span class="va">evmodel2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fmridesign/man/event_model.html" class="external-link">event_model</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">onsets</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/fmridesign/man/hrf.html" class="external-link">hrf</a></span><span class="op">(</span><span class="va">condition</span>, basis <span class="op">=</span> <span class="st">"fourier"</span>, nbasis <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">event_data</span>,</span></span>
<span class="r-in"><span>  block <span class="op">=</span> <span class="op">~</span><span class="va">run</span>,</span></span>
<span class="r-in"><span>  sampling_frame <span class="op">=</span> <span class="va">sframe</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get F-contrasts testing all basis functions</span></span></span>
<span class="r-in"><span><span class="va">basis_contrasts</span> <span class="op">&lt;-</span> <span class="fu">Fcontrasts</span><span class="op">(</span><span class="va">evmodel2</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in UseMethod("Fcontrasts"):</span> no applicable method for 'Fcontrasts' applied to an object of class "c('event_model', 'list')"</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/bbuchsbaum" class="external-link">Bradley Buchsbaum</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

