<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>GLM LSS Estimation Convenience Function (Single Trial Estimation) — glm_lss • fmrireg</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="GLM LSS Estimation Convenience Function (Single Trial Estimation) — glm_lss"><meta name="description" content="A convenience wrapper around estimate_betas for least squares separate (LSS) estimation.
This is primarily designed for single trial estimation, where each individual trial/event
gets its own separate beta estimate rather than averaging across trials of the same condition."><meta property="og:description" content="A convenience wrapper around estimate_betas for least squares separate (LSS) estimation.
This is primarily designed for single trial estimation, where each individual trial/event
gets its own separate beta estimate rather than averaging across trials of the same condition."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fmrireg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/Overview.html">Package Overview</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/a_05_contrasts.html">Contrasts</a></li>
    <li><a class="dropdown-item" href="../articles/a_08_simulation.html">Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/a_09_linear_model.html">Linear Modeling</a></li>
    <li><a class="dropdown-item" href="../articles/a_10_dataset.html">Dataset Management</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Resources</h6></li>
    <li><a class="dropdown-item" href="../articles/benchmark_datasets.html">Benchmark Datasets</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/bbuchsbaum/fmrireg/releases/tag/v0.1.0">Version 0.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbuchsbaum/fmrireg/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>GLM LSS Estimation Convenience Function (Single Trial Estimation)</h1>
      <small class="dont-index">Source: <a href="https://github.com/bbuchsbaum/fmrireg/blob/master/R/fmri_betas.R" class="external-link"><code>R/fmri_betas.R</code></a></small>
      <div class="d-none name"><code>glm_lss.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A convenience wrapper around <code>estimate_betas</code> for least squares separate (LSS) estimation.
<strong>This is primarily designed for single trial estimation</strong>, where each individual trial/event
gets its own separate beta estimate rather than averaging across trials of the same condition.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">glm_lss</span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>,</span>
<span>  <span class="va">model_obj</span>,</span>
<span>  <span class="va">basis_obj</span>,</span>
<span>  basemod <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  block <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>  use_cpp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dataset">dataset<a class="anchor" aria-label="anchor" href="#arg-dataset"></a></dt>
<dd><p>A <code>matrix_dataset</code> object containing the fMRI time series data</p></dd>


<dt id="arg-model-obj">model_obj<a class="anchor" aria-label="anchor" href="#arg-model-obj"></a></dt>
<dd><p>An <code>event_model</code> object specifying the experimental design</p></dd>


<dt id="arg-basis-obj">basis_obj<a class="anchor" aria-label="anchor" href="#arg-basis-obj"></a></dt>
<dd><p>An HRF basis object (e.g., from <code><a href="https://bbuchsbaum.github.io/fmrihrf/reference/HRF_objects.html" class="external-link">fmrihrf::HRF_SPMG1</a></code>, <code>HRF_FIR</code>, etc.)</p></dd>


<dt id="arg-basemod">basemod<a class="anchor" aria-label="anchor" href="#arg-basemod"></a></dt>
<dd><p>A <code>baseline_model</code> instance to regress out of data before beta estimation (default: NULL)</p></dd>


<dt id="arg-block">block<a class="anchor" aria-label="anchor" href="#arg-block"></a></dt>
<dd><p>A formula specifying the block factor (default: ~ 1 for single block)</p></dd>


<dt id="arg-use-cpp">use_cpp<a class="anchor" aria-label="anchor" href="#arg-use-cpp"></a></dt>
<dd><p>Logical; whether to use C++ implementation for speed (default: TRUE)</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>Logical; show progress bar (default: TRUE)</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <code>estimate_betas</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of class "fmri_betas" containing the estimated trial-wise coefficients</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Primary Use Case - Single Trial Estimation:</strong></p><ul><li><p><strong>Trial-wise beta estimation</strong>: Each trial gets its own beta coefficient</p></li>
<li><p><strong>Single trial analysis</strong>: Useful for decoding, representational similarity analysis (RSA)</p></li>
<li><p><strong>Trial-by-trial variability</strong>: Captures individual trial responses rather than condition averages</p></li>
<li><p><strong>Avoiding trial averaging</strong>: Preserves trial-specific information that would be lost in standard GLM</p></li>
</ul><p><strong>Method Details:</strong>
LSS (Least Squares Separate) fits a separate model for each trial, where the trial of interest
gets its own regressor while all other trials of the same condition are modeled together. This
approach avoids the collinearity issues that would arise from including separate regressors
for every trial simultaneously.</p>
<p>For standard condition-level estimation (averaging trials within conditions), use <code><a href="glm_ols.html">glm_ols()</a></code> instead.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="estimate_betas.html">estimate_betas</a></code> for the underlying estimation function,
<code><a href="glm_ols.html">glm_ols</a></code> for condition-level estimation</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Create event model and data</span></span></span>
<span class="r-in"><span><span class="va">event_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  run <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sframe</span> <span class="op">&lt;-</span> <span class="fu">fmrihrf</span><span class="fu">::</span><span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span>blocklens <span class="op">=</span> <span class="fl">100</span>, TR <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fmridesign/man/event_model.html" class="external-link">event_model</a></span><span class="op">(</span><span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/fmridesign/man/hrf.html" class="external-link">hrf</a></span><span class="op">(</span><span class="va">condition</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                        data <span class="op">=</span> <span class="va">event_data</span>, </span></span>
<span class="r-in"><span>                        block <span class="op">=</span> <span class="op">~</span> <span class="va">run</span>, </span></span>
<span class="r-in"><span>                        sampling_frame <span class="op">=</span> <span class="va">sframe</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create data matrix (100 timepoints, 10 voxels)</span></span></span>
<span class="r-in"><span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create matrix_dataset with event table</span></span></span>
<span class="r-in"><span><span class="va">dset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmridataset/reference/matrix_dataset.html" class="external-link">matrix_dataset</a></span><span class="op">(</span><span class="va">Y</span>, TR <span class="op">=</span> <span class="fl">2</span>, run_length <span class="op">=</span> <span class="fl">100</span>, event_table <span class="op">=</span> <span class="va">event_data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit with LSS - estimates separate beta for each individual trial</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">glm_lss</span><span class="op">(</span><span class="va">dset</span>, <span class="va">model_obj</span>, <span class="fu">fmrihrf</span><span class="fu">::</span><span class="va"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/HRF_objects.html" class="external-link">HRF_SPMG1</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">betas_ran</span><span class="op">)</span>  <span class="co"># 4 trials x 10 voxels (NOT averaged by condition)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This is useful for:</span></span></span>
<span class="r-in"><span><span class="co"># - Decoding analysis (predicting condition from single trial patterns)</span></span></span>
<span class="r-in"><span><span class="co"># - RSA (representational similarity analysis)</span></span></span>
<span class="r-in"><span><span class="co"># - Studying trial-by-trial variability</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/bbuchsbaum" class="external-link">Bradley Buchsbaum</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

