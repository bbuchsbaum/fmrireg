% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/rank1_estimation.R
\name{r1_glm_separate_betas2}
\alias{r1_glm_separate_betas2}
\title{Estimate activation coefficients and HRF using Rank-1 GLM with Separate Designs (R1-GLMS)}
\usage{
r1_glm_separate_betas2(
  X_list,
  y,
  Z = NULL,
  hrf_basis,
  hrf_ref,
  maxit = 100,
  flip_sign = TRUE,
  use_box_constraints = FALSE
)
}
\arguments{
\item{X_list}{A list of numeric matrices, each of size \eqn{n \times (k*m)}, where \eqn{n} is the number
of time-points, \eqn{k} is the number of conditions, and \eqn{m} is the number
of basis functions.  Each matrix in the list should be a separate design matrix
for a given condition. Usually constructed by convolving condition onsets with basis functions.}

\item{y}{Numeric vector of length \eqn{n} containing the BOLD signal at a single voxel.}

\item{Z}{Optional numeric matrix of nuisance regressors of size \eqn{n \times q}.}

\item{hrf_basis}{Numeric matrix \eqn{T \times m} with HRF basis functions
(one column per basis function).}

\item{hrf_ref}{Numeric vector of length \eqn{T} representing a reference HRF.}

\item{maxit}{Integer, maximum number of iterations for the optimizer. Default is 100.}

\item{flip_sign}{Logical, whether to enforce a positive correlation between the
estimated HRF and the reference HRF. Default is TRUE.}

\item{use_box_constraints}{Logical, whether to use box constraints on the HRF parameters
if \code{m = 3}. The constraints used are similar to those provided in the other snippet.
By default FALSE. If TRUE and \code{m=3}, HRF parameters are forced into \code{(-1,1)} and
scaled so that the first parameter is constrained to 1. This is a strong constraint.}
}
\value{
A list with elements:
\item{beta}{Numeric vector of length \eqn{k} representing the estimated activation coefficients.}
\item{h}{Numeric vector of length \eqn{m} representing the estimated HRF coefficients in the chosen basis.}
\item{omega}{Numeric vector of length \eqn{q} with nuisance parameters (if any).}
\item{r}{Numeric vector of length \eqn{k} with nuisance parameters used for the model with separate designs (if any)}
\item{converged}{Logical indicating whether the optimizer converged.}
\item{value}{Final value of the objective function.}
}
\description{
This function implements the Rank-1 constrained GLM with Separate Designs (R1-GLMS)
for joint estimation of activation coefficients (betas) and the HRF given a set of
design matrices and BOLD response. It enforces a shared HRF across all conditions,
yet allows the activation coefficients to differ. It uses a quasi-Newton approach
(L-BFGS-B) for optimization.
}
\details{
This version includes optional parameters to:
\itemize{
\item Apply a sign-flip step to enforce a positive correlation between the
estimated HRF and a given reference HRF.
\item Apply simple box constraints on HRF parameters when using exactly three
basis functions, mirroring the approach used in the provided code snippet.
}
}
\examples{
# Example (mock data):
set.seed(42)
n <- 200; k <- 10; m <- 3; q <- 5
X_list <- lapply(1:k, function(i) matrix(rnorm(n*m*2), n, m*2))
y <- rnorm(n)
Z <- matrix(rnorm(n*q), n, q)
hrf_basis <- matrix(rnorm(32*m), 32, m) # 32 time points HRF model
hrf_ref <- dgamma(seq(0, 31, length.out=32), shape=6, rate=1) # a gamma HRF shape

res <- r1_glm_separate_betas(
  X_list, y, Z, hrf_basis, hrf_ref, maxit=50, flip_sign=FALSE, use_box_constraints=TRUE
)
str(res)

}
\references{
Pedregosa F, Eickenberg M, Ciuciu P, Thirion B, Gramfort A (2015)
Data-driven HRF estimation for encoding and decoding models. NeuroImage 104:209-220.
}
