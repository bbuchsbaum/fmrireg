% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/soft_subspace_projection.R
\name{soft_subspace_projection}
\alias{soft_subspace_projection}
\title{Soft Subspace Projection for Nuisance Removal}
\description{
Ridge-regularized projection to remove nuisance variance without
explicitly choosing components or adding confound regressors.
This is "CompCor without choosing components."
}
\section{Conceptual Overview}{

Traditional CompCor extracts K principal components from white matter/CSF
and regresses them out. This requires choosing K, which is arbitrary.

Soft subspace projection instead treats the entire WM/CSF timeseries as a
nuisance basis and removes it with shrinkage. Each nuisance direction is
partially removed proportional to its variance, avoiding the hard keep/delete
decision of PCA truncation.
}

\section{The Projection Operator}{

Given nuisance matrix N (time x nuisance_voxels), the soft projection is:
\deqn{P_\lambda = I - N (N^T N + \lambda I)^{-1} N^T}

Applied to data Y and design X:
\itemize{
\item \code{Y_clean = P_lambda \%*\% Y}

\item \code{X_clean = P_lambda \%*\% X} (important to avoid bias)
}
}

\section{Lambda Selection}{

The shrinkage parameter lambda controls aggressiveness:
\itemize{
\item Small lambda: aggressive removal (risk removing signal)
\item Large lambda: gentle removal (risk leaving nuisance)
}

Three selection methods are available:
\describe{
\item{"auto"}{Singular value heuristic: \code{lambda = median(d^2)} where d
are singular values of N. Fast, stable, no tuning. Components with variance
below median are heavily shrunk; above median lightly shrunk.}
\item{"gcv"}{Generalized cross-validation minimizes \code{RSS/(1-df/n)^2}
for ridge regression of Y on N. Finds lambda giving best leave-one-out
prediction without actually doing LOO. Requires Y.
Computational cost is O(k) per evaluation where k = min(n, p).}
\item{numeric}{User-specified lambda value.}
}
}

\section{Typical Usage}{

The soft subspace projection workflow has three steps:
\enumerate{
\item Extract nuisance timeseries from WM/CSF mask (or provide pre-computed)
\item Create the soft projection operator
\item Apply to both data Y and design matrix X before GLM fitting
}

For use within \code{fmri_lm()}, see the convenience parameter
\code{nuisance_projection} or the more detailed \code{soft_subspace_options}.
}

\section{When to Use}{

Soft subspace projection is most beneficial when:
\itemize{
\item You have physiological noise from WM/CSF that isn't captured by motion parameters
\item Traditional CompCor requires arbitrary component selection
\item You want to avoid adding many confound regressors to the design
}

Consider alternatives when:
\itemize{
\item Motion parameters alone sufficiently control artifacts
\item You prefer explicit confound regressors for interpretability
\item Data has very few timepoints relative to nuisance dimensions
}
}

