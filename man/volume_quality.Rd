% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/volume_quality.R
\name{volume_quality}
\alias{volume_quality}
\title{Volume Quality Metrics and Temporal Weighting}
\description{
Functions for computing volume-level quality metrics (DVARS) and
converting them to weights for weighted least squares fitting.
This implements "soft scrubbing" - downweighting bad volumes rather
than hard censoring them.
}
\section{Conceptual Overview}{

Traditional fMRI artifact removal uses hard censoring ("scrubbing"),
where volumes exceeding a threshold are completely removed. This
loses temporal information and can create discontinuities.

Soft scrubbing instead assigns each volume a weight between 0 and 1
based on its quality. High-quality volumes receive full weight;
artifacts receive reduced weight. This preserves temporal continuity
while still downweighting problematic data.
}

\section{DVARS as Quality Metric}{

DVARS (Derivative of VARiance across voxels) measures the root mean square
of the temporal derivative across all voxels:
\deqn{DVARS_t = \sqrt{\frac{1}{V} \sum_v (Y_{t,v} - Y_{t-1,v})^2}}

Interpretation:
\itemize{
\item Low DVARS: signal changed smoothly from previous volume (good)
\item High DVARS: signal changed rapidly (possible artifact or motion)
\item Normalized DVARS: values ~1 are typical; >1.5 suggests artifacts
}
}

\section{Weighting Methods}{

Three methods convert DVARS to weights, offering different trade-offs:

\describe{
\item{inverse_squared}{
Formula: \code{w = 1 / (1 + dvars^2)}

\if{html}{\out{<div class="sourceCode">}}\preformatted{Properties: Smooth, continuous decay. A volume with DVARS=1 gets
weight 0.5. Most conservative choice - provides gentle downweighting
even for moderately elevated DVARS.

Use when: You want smooth, gradual artifact handling without
sharp transitions.
}\if{html}{\out{</div>}}

}

\item{soft_threshold}{
Formula: Sigmoid decay above threshold

\if{html}{\out{<div class="sourceCode">}}\preformatted{Properties: Volumes below threshold get full weight; above
threshold, weights decay smoothly. Steepness parameter controls
how rapidly weights drop.

Use when: You have a clear idea of what "acceptable" DVARS looks
like (e.g., 1.5x median) and want to preserve good volumes fully.
}\if{html}{\out{</div>}}

}

\item{tukey}{
Formula: Tukey bisquare \code{(1 - u^2)^2} for \code{|u| <= 1}

\if{html}{\out{<div class="sourceCode">}}\preformatted{Properties: Complete downweighting for extreme values. Volumes
beyond 2x threshold get zero weight. Most aggressive choice.

Use when: You have clear artifacts that should be fully excluded,
similar to hard scrubbing but with smooth transitions.
}\if{html}{\out{</div>}}

}
}
}

\section{When to Use Volume Weighting vs Robust Fitting}{

Both approaches handle artifacts, but through different mechanisms:

\strong{Volume weighting} downweights entire timepoints uniformly across
all voxels. Best when artifacts affect the whole brain (head motion,
scanner spikes).

\strong{Robust fitting} (Huber/Tukey bisquare) downweights outlier
residuals voxel-by-voxel. Best when artifacts are spatially localized
or when temporal structure matters.

\strong{Combined approach}: Use volume weighting for global artifacts
plus robust fitting for residual voxel-level outliers. Set
\code{robust = TRUE, volume_weights = TRUE} in \code{fmri_lm()}.
}

\section{Typical Usage}{

For use within \code{fmri_lm()}, see the convenience parameter
\code{volume_weights} or the more detailed \code{volume_weights_options}.
}

