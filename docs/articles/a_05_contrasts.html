<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contrasts • fmrireg</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Contrasts">
<meta property="og:description" content="fmrireg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fmrireg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a_01_hemodynamic_response.html">Hemodynamic Response Functions</a>
    </li>
    <li>
      <a href="../articles/a_02_regressor.html">Building Regressors</a>
    </li>
    <li>
      <a href="../articles/a_03_baseline_model.html">Baseline Model</a>
    </li>
    <li>
      <a href="../articles/a_04_event_models.html">Event Models</a>
    </li>
    <li>
      <a href="../articles/a_05_contrasts.html">Contrasts</a>
    </li>
    <li>
      <a href="../articles/a_06_afni.html">Translating to AFNI 3dDeconvolve</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bbuchsbaum/fmrireg/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="a_05_contrasts_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Contrasts</h1>
                        <h4 class="author">Bradley R. Buchsbaum</h4>
            
            <h4 class="date">2020-09-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bbuchsbaum/fmrireg/blob/master/vignettes/a_05_contrasts.Rmd"><code>vignettes/a_05_contrasts.Rmd</code></a></small>
      <div class="hidden name"><code>a_05_contrasts.Rmd</code></div>

    </div>

    
    
<div id="contrasts" class="section level2">
<h2 class="hasAnchor">
<a href="#contrasts" class="anchor"></a>Contrasts</h2>
<p>Statistical contrasts are an important component of <em>f</em>MRI analyses. Contrasts allow for testing of hypotheses about the relative brain activity between two or more conditions. Our aim is to provide a flexible interface for describing contrasts and generating contrast weight vectors that can be applied to linear models.</p>
<div id="a-simple-2-by-2-experiment" class="section level3">
<h3 class="hasAnchor">
<a href="#a-simple-2-by-2-experiment" class="anchor"></a>A simple 2 by 2 experiment</h3>
<p>The approach we take in specifying contrasts is to formulate them as regular R expressions using the <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code> operator. To demonstrate, lets start with a simple two-by-two design with factors <em>category</em> with levels [face,scene] and <em>attention</em> with levels [attend,ignore]. For this simple design, we assume each condition is repeated twice in a single run.</p>
<p>First we construct the fMRI design as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(category=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"face"</span>, <span class="st">"scene"</span>), attention=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"attend"</span>, <span class="st">"ignore"</span>), replication=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>))
<span class="kw">design</span><span class="op">$</span><span class="kw">onsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>, <span class="fl">100</span>, length.out=<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">design</span>))
<span class="kw">design</span><span class="op">$</span><span class="kw">block</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">design</span>))
</pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">category</th>
<th align="left">attention</th>
<th align="right">replication</th>
<th align="right">onsets</th>
<th align="right">block</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">face</td>
<td align="left">attend</td>
<td align="right">1</td>
<td align="right">1.00000</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">scene</td>
<td align="left">attend</td>
<td align="right">1</td>
<td align="right">15.14286</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">face</td>
<td align="left">ignore</td>
<td align="right">1</td>
<td align="right">29.28571</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">scene</td>
<td align="left">ignore</td>
<td align="right">1</td>
<td align="right">43.42857</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">face</td>
<td align="left">attend</td>
<td align="right">2</td>
<td align="right">57.57143</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">scene</td>
<td align="left">attend</td>
<td align="right">2</td>
<td align="right">71.71429</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">face</td>
<td align="left">ignore</td>
<td align="right">2</td>
<td align="right">85.85714</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">scene</td>
<td align="left">ignore</td>
<td align="right">2</td>
<td align="right">100.00000</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<div id="creating-contrasts-to-test-experimental-effects" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-contrasts-to-test-experimental-effects" class="anchor"></a>Creating contrasts to test experimental effects</h3>
<p>In a two by two design, there are a number of experimental effects that we might be interested in testing, for example: (1) the effect of <em>category</em> (face &gt; scene), (2) the effect of <em>attention</em> (attend &gt; ignored), and (3) the interaction between <em>category</em> and <em>attention</em>. All of these effects can be formulated as contrasts of weighted averages of condition effects, yielding directional (i.e. signed) <em>t</em>-statistics. Below we show how each contrast can be expressed:</p>
<ol style="list-style-type: decimal">
<li><code>face_scene &lt;- pair_contrast(~ category == "face", ~ category == "scene")</code></li>
<li><code>attend_ignored &lt;- pair_contrast(~ attention == "attend", ~ attention == "ignored")</code></li>
<li><code>category_by_attention &lt;- contrast(~ (face:attend - face:ignored) - (scene:attend + scene:ignored), name="category_by_attention"))</code></li>
</ol>
<p>In the following sections we will explain the syntax used in the examples above.</p>
</div>
<div id="contrasting-two-sets-of-conditions" class="section level3">
<h3 class="hasAnchor">
<a href="#contrasting-two-sets-of-conditions" class="anchor"></a>Contrasting two sets of conditions</h3>
<p>We often want to compare two conditions, or two <em>sets of conditions</em>, for a difference in <em>f</em>MRI activity. Such contrasts can be described, generically, as involving an expression <code>A - B</code>, where <code>A</code> represents the weights for the first set of conditions and <code>B</code> represents the weights for the second set of conditions.</p>
<p>If sum of the <code>A</code> weights is 1 and the sum of the ‘B’ weights is also 1, then the difference in these weights (<code>A - B</code>) is 0. Thus, the difference in the weights <em>sum to zero</em>, which is what we want when the <strong>null hypothesis</strong> is that A == B.</p>
</div>
<div id="the-pair_contrast-function" class="section level3">
<h3 class="hasAnchor">
<a href="#the-pair_contrast-function" class="anchor"></a>The <code>pair_contrast</code> function</h3>
<p>A simple way to contruct this sort of <code>A - B</code> contrast is to use the <code>pair_contrast</code> function, which takes as arguments two “matching expressions”, <code>A</code> and <code>B</code>. In example 1 from the previous section, the first expression (<code>category == "face"</code>) matches all conditions where the category <code>factor</code> equals the level “face”. The second expression (<code>category == "scene"</code>) matches all conditions where the category <code>factor</code> equals the level “scene”.</p>
<p>To compute contrast weights, every matching level in the two expressions will be assigned a weight of 1 for a match and zero otherwise. The respective binary weight vectors are then normalized to sum to 1 and then subtracted (<code>A - B</code>) to form the contrast weights.</p>
<p>Notice in the above examples, the contrasts are defined abstractly without supplying any corresponding design information. To compute the contrast weights, however, we need to supply the design information. Below, we show a complete example.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">sframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sampling_frame.html">sampling_frame</a></span>(<span class="fl">100</span>, <span class="fl">2</span>)
<span class="kw">emodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/event_model.html">event_model</a></span>(<span class="kw">onsets</span> <span class="op">~</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span>(<span class="kw">category</span>,<span class="kw">attention</span>), block=<span class="op">~</span><span class="kw">block</span>, data=<span class="kw">design</span>, sampling_frame=<span class="kw">sframe</span>)
</pre></div>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">term1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/terms.html">terms</a></span>(<span class="kw">emodel</span>)[[<span class="fl">1</span>]] 
</pre></div>
<p>And here is the relevant model term (the only term in this model):</p>
<pre><code>## fmri_term:  convolved_term 
##    Term Name:  category:attention 
##    Formula:   ~ (category:attention - 1) 
##    Num Events:  8 
##    Num Rows:  100 
##    Num Columns:  4 
##    Conditions:  category[face]:attention[attend] category[scene]:attention[attend] category[face]:attention[ignore] category[scene]:attention[ignore] 
##    Term Types:  event_factor event_factor</code></pre>
<p>Now, we create two <code>pair_contrast</code>s and compute the weights:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">con1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pair_contrast.html">pair_contrast</a></span>(<span class="op">~</span> <span class="kw">category</span> <span class="op">==</span> <span class="st">"face"</span>, <span class="op">~</span> <span class="kw">category</span> <span class="op">==</span> <span class="st">"scene"</span>, name=<span class="st">"face_scene"</span>)
<span class="kw">con2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pair_contrast.html">pair_contrast</a></span>(<span class="op">~</span> <span class="kw">attention</span> <span class="op">==</span> <span class="st">"attend"</span>, <span class="op">~</span> <span class="kw">attention</span> <span class="op">==</span> <span class="st">"ignore"</span>, name=<span class="st">"attend_ignore"</span>)

<span class="kw">wts1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/contrast_weights.html">contrast_weights</a></span>(<span class="kw">con1</span>, <span class="kw">term1</span>)
<span class="kw">wts2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/contrast_weights.html">contrast_weights</a></span>(<span class="kw">con2</span>, <span class="kw">term1</span>)
</pre></div>
<p>wts1:</p>
<pre><code>## contrast: face_scene 
##  A:  ~category == "face" 
##  B:  ~category == "scene" 
##  term:  category:attention 
##  weights:  
##                                 [,1]
## category#face:attention#attend   0.5
## category#scene:attention#attend -0.5
## category#face:attention#ignore   0.5
## category#scene:attention#ignore -0.5
##  conditions:  category#face:attention#attend category#scene:attention#attend category#face:attention#ignore category#scene:attention#ignore</code></pre>
<pre><code>## Warning in kable_pipe(x = structure(c("category#face:attention#attend", : The
## table should have a header (column names)</code></pre>
<table class="table"><tbody>
<tr class="odd">
<td align="left">category#face:attention#attend</td>
<td align="right">0.5</td>
</tr>
<tr class="even">
<td align="left">category#scene:attention#attend</td>
<td align="right">-0.5</td>
</tr>
<tr class="odd">
<td align="left">category#face:attention#ignore</td>
<td align="right">0.5</td>
</tr>
<tr class="even">
<td align="left">category#scene:attention#ignore</td>
<td align="right">-0.5</td>
</tr>
</tbody></table>
<p>wts2:</p>
<pre><code>## contrast: attend_ignore 
##  A:  ~attention == "attend" 
##  B:  ~attention == "ignore" 
##  term:  category:attention 
##  weights:  
##                                 [,1]
## category#face:attention#attend   0.5
## category#scene:attention#attend  0.5
## category#face:attention#ignore  -0.5
## category#scene:attention#ignore -0.5
##  conditions:  category#face:attention#attend category#scene:attention#attend category#face:attention#ignore category#scene:attention#ignore</code></pre>
<pre><code>## Warning in kable_pipe(x = structure(c("category#face:attention#attend", : The
## table should have a header (column names)</code></pre>
<table class="table"><tbody>
<tr class="odd">
<td align="left">category#face:attention#attend</td>
<td align="right">0.5</td>
</tr>
<tr class="even">
<td align="left">category#scene:attention#attend</td>
<td align="right">0.5</td>
</tr>
<tr class="odd">
<td align="left">category#face:attention#ignore</td>
<td align="right">-0.5</td>
</tr>
<tr class="even">
<td align="left">category#scene:attention#ignore</td>
<td align="right">-0.5</td>
</tr>
</tbody></table>
</div>
</div>
<div id="unit-contrasts-and-the-implicit-baseline" class="section level2">
<h2 class="hasAnchor">
<a href="#unit-contrasts-and-the-implicit-baseline" class="anchor"></a>Unit contrasts and the “implicit baseline”</h2>
<p>a “unit contrast” tests whether activation, averaged over one or more conditions, is greater than the baseline activity. In this case “baseline” is defined as the level of activation captured by the intercept term, or the <em>implicit baseline</em> in <em>f</em>MRI parlance. Because all beta estimates are already expressed relative to the intercept term, main effect contrast vectors always sum to 1, rather than 0. We therefore refer to the sum-to-one contrasts as: “unit contrasts”.</p>
<p>Below we show how to construct two unit contrasts, one testing for the effect of <code>face &gt; baseline</code> and for <code>scene - baseline</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">con1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unit_contrast.html">unit_contrast</a></span>(<span class="op">~</span> <span class="kw">category</span> <span class="op">==</span> <span class="st">"face"</span>, name=<span class="st">"face_baseline"</span>)
<span class="kw">con2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unit_contrast.html">unit_contrast</a></span>(<span class="op">~</span> <span class="kw">category</span> <span class="op">==</span> <span class="st">"scene"</span>,name=<span class="st">"scene_baseline"</span>)

<span class="kw">wts1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/contrast_weights.html">contrast_weights</a></span>(<span class="kw">con1</span>, <span class="kw">term1</span>)
<span class="kw">wts2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/contrast_weights.html">contrast_weights</a></span>(<span class="kw">con2</span>, <span class="kw">term1</span>)
</pre></div>
<p>wts1:</p>
<pre><code>## contrast: face_baseline 
##  A:  ~category == "face" 
##  term:  category:attention 
##  weights:  
##                                 [,1]
## category#face:attention#attend  0.25
## category#scene:attention#attend 0.25
## category#face:attention#ignore  0.25
## category#scene:attention#ignore 0.25
##  conditions:  category#face:attention#attend category#scene:attention#attend category#face:attention#ignore category#scene:attention#ignore</code></pre>
<pre><code>## Warning in kable_pipe(x = structure(c("category#face:attention#attend", : The
## table should have a header (column names)</code></pre>
<table class="table"><tbody>
<tr class="odd">
<td align="left">category#face:attention#attend</td>
<td align="right">0.25</td>
</tr>
<tr class="even">
<td align="left">category#scene:attention#attend</td>
<td align="right">0.25</td>
</tr>
<tr class="odd">
<td align="left">category#face:attention#ignore</td>
<td align="right">0.25</td>
</tr>
<tr class="even">
<td align="left">category#scene:attention#ignore</td>
<td align="right">0.25</td>
</tr>
</tbody></table>
<p>wts2:</p>
<pre><code>## contrast: scene_baseline 
##  A:  ~category == "scene" 
##  term:  category:attention 
##  weights:  
##                                 [,1]
## category#face:attention#attend  0.25
## category#scene:attention#attend 0.25
## category#face:attention#ignore  0.25
## category#scene:attention#ignore 0.25
##  conditions:  category#face:attention#attend category#scene:attention#attend category#face:attention#ignore category#scene:attention#ignore</code></pre>
<pre><code>## Warning in kable_pipe(x = structure(c("category#face:attention#attend", : The
## table should have a header (column names)</code></pre>
<table class="table"><tbody>
<tr class="odd">
<td align="left">category#face:attention#attend</td>
<td align="right">0.25</td>
</tr>
<tr class="even">
<td align="left">category#scene:attention#attend</td>
<td align="right">0.25</td>
</tr>
<tr class="odd">
<td align="left">category#face:attention#ignore</td>
<td align="right">0.25</td>
</tr>
<tr class="even">
<td align="left">category#scene:attention#ignore</td>
<td align="right">0.25</td>
</tr>
</tbody></table>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
