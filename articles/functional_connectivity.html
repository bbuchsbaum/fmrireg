<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title> • fmrireg</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fmrireg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/Overview.html">Package Overview</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/a_05_contrasts.html">Contrasts</a></li>
    <li><a class="dropdown-item" href="../articles/a_08_simulation.html">Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/a_09_linear_model.html">Linear Modeling</a></li>
    <li><a class="dropdown-item" href="../articles/sketched-ar.html">Sketched GLM (SRHT/IHS + Nyström)</a></li>
    <li><a class="dropdown-item" href="../articles/a_10_dataset.html">Dataset Management</a></li>
    <li><a class="dropdown-item" href="../articles/group_analysis.html">Group Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/functional_connectivity.html">Functional Connectivity</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Resources</h6></li>
    <li><a class="dropdown-item" href="../articles/benchmark_datasets.html">Benchmark Datasets</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/bbuchsbaum/fmrireg/releases/tag/v0.1.0">Version 0.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbuchsbaum/fmrireg/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bbuchsbaum/fmrireg/blob/master/vignettes/functional_connectivity.Rmd" class="external-link"><code>vignettes/functional_connectivity.Rmd</code></a></small>
      <div class="d-none name"><code>functional_connectivity.Rmd</code></div>
    </div>

    
    
<p>title: “Seed-based Functional Connectivity Analysis” author: “Bradley
R. Buchsbaum” date: “2025-09-24” output: rmarkdown::html_vignette
vignette: &gt; % % % —</p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Seed-based functional connectivity analysis is a fundamental
technique in fMRI research for identifying brain regions that show
correlated activity with a specific region of interest (the “seed”).
This vignette demonstrates how to perform seed-based connectivity
analysis using fmrireg’s flexible design matrix and GLM framework.</p>
<p>The approach we’ll take treats the seed time series as an
experimental regressor rather than computing simple correlations. This
allows us to control for nuisance variables like scanner drift and
motion parameters while estimating connectivity strength. The resulting
t-statistics provide a connectivity map showing which voxels have
activity significantly related to the seed region after accounting for
confounds.</p>
<p>To illustrate the method clearly, we’ll work with simulated data
where we know the ground truth. We’ll create a dataset with a hidden
network of voxels that share a common signal with our seed region, then
recover this network using our connectivity analysis.</p>
</div>
<div class="section level2">
<h2 id="creating-a-test-dataset-with-known-connectivity">Creating a Test Dataset with Known Connectivity<a class="anchor" aria-label="anchor" href="#creating-a-test-dataset-with-known-connectivity"></a>
</h2>
<p>First, we’ll generate a simulated fMRI dataset where we control which
voxels are functionally connected. This allows us to validate our
analysis method since we know the true connectivity pattern.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the temporal parameters for our scan</span></span>
<span><span class="va">Tlen</span> <span class="op">&lt;-</span> <span class="fl">180</span>  <span class="co"># 180 time points</span></span>
<span><span class="va">TR</span>   <span class="op">&lt;-</span> <span class="fl">2</span>    <span class="co"># 2-second repetition time</span></span>
<span></span>
<span><span class="co"># Generate baseline fMRI data with realistic noise properties</span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_fmri_matrix.html">simulate_fmri_matrix</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">256</span>,                  <span class="co"># number of voxels</span></span>
<span>  total_time <span class="op">=</span> <span class="va">Tlen</span> <span class="op">*</span> <span class="va">TR</span>,</span>
<span>  TR <span class="op">=</span> <span class="va">TR</span>,</span>
<span>  n_events <span class="op">=</span> <span class="fl">5</span>,             <span class="co"># events are not used here; we ignore the event_table</span></span>
<span>  durations <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  noise_type <span class="op">=</span> <span class="st">"ar1"</span>,       <span class="co"># autoregressive noise typical of fMRI</span></span>
<span>  noise_ar <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  noise_sd <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>  random_seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dset</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="va">time_series</span>  </span>
<span><span class="va">Y</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmridataset/reference/get_data_matrix.html" class="external-link">get_data_matrix</a></span><span class="op">(</span><span class="va">dset</span><span class="op">)</span>  <span class="co"># Extract the T x V data matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 180 256</span></span></code></pre></div>
<p>Now we’ll create our ground truth connectivity pattern. We generate a
seed time series with temporal autocorrelation (mimicking real neural
activity) and inject this signal into a subset of voxels to create a
“network” that’s functionally connected to our seed.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate a seed signal with realistic temporal properties</span></span>
<span><span class="va">seed_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/arima.sim.html" class="external-link">arima.sim</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ar <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, n <span class="op">=</span> <span class="va">Tlen</span><span class="op">)</span></span>
<span><span class="va">seed_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">seed_ts</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define which voxels belong to our network</span></span>
<span><span class="va">V</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="va">seed_voxel</span> <span class="op">&lt;-</span> <span class="fl">10</span>  <span class="co"># Our seed is voxel 10</span></span>
<span><span class="va">net_idx</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">seed_voxel</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">V</span>, <span class="va">seed_voxel</span><span class="op">)</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span>  <span class="co"># 41 connected voxels</span></span>
<span></span>
<span><span class="co"># Add the seed signal to network voxels (creating functional connectivity)</span></span>
<span><span class="va">Y</span><span class="op">[</span>, <span class="va">net_idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">[</span>, <span class="va">net_idx</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.6</span> <span class="op">*</span> <span class="va">seed_ts</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="modeling-scanner-drift">Modeling Scanner Drift<a class="anchor" aria-label="anchor" href="#modeling-scanner-drift"></a>
</h2>
<p>Before we can accurately estimate connectivity, we need to account
for low-frequency scanner drift that can create spurious correlations
between voxels. The fmrireg package provides flexible tools for modeling
these nuisance signals using basis functions.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a sampling frame for our single run</span></span>
<span><span class="va">sframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">Tlen</span>, <span class="fl">1</span><span class="op">)</span>, TR <span class="op">=</span> <span class="va">TR</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model drift using B-splines</span></span>
<span><span class="va">bmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmridesign/reference/baseline_model.html" class="external-link">baseline_model</a></span><span class="op">(</span>basis <span class="op">=</span> <span class="st">"bs"</span>, degree <span class="op">=</span> <span class="fl">3</span>, sframe <span class="op">=</span> <span class="va">sframe</span><span class="op">)</span></span>
<span><span class="va">X_drift</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://bbuchsbaum.github.io/fmridesign/reference/design_matrix.html" class="external-link">design_matrix</a></span><span class="op">(</span><span class="va">bmodel</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X_drift</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="connectivity-analysis-using-fmriregs-glm-framework">Connectivity Analysis Using fmrireg’s GLM Framework<a class="anchor" aria-label="anchor" href="#connectivity-analysis-using-fmriregs-glm-framework"></a>
</h2>
<p>Now comes the key insight of our approach: instead of computing
simple correlations, we’ll treat the seed time series as an experimental
regressor in a GLM. This allows us to estimate connectivity while
simultaneously controlling for confounds. The <code><a href="https://bbuchsbaum.github.io/fmridesign/reference/covariate.html" class="external-link">covariate()</a></code>
function in fmridesign is perfect for this, as it adds regressors
without HRF convolution (since the seed signal is already a BOLD time
series).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set up the event model structure</span></span>
<span><span class="co"># We need a minimal event_data frame to define the model structure</span></span>
<span><span class="va">event_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  onset <span class="op">=</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/samples.html" class="external-link">samples</a></span><span class="op">(</span><span class="va">sframe</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,  <span class="co"># Single onset to define the model</span></span>
<span>  run <span class="op">=</span> <span class="fl">1</span>                       <span class="co"># Single run indicator</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The seed time series is provided as covariate data</span></span>
<span><span class="va">cov_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  seed <span class="op">=</span> <span class="va">seed_ts</span>  <span class="co"># Our seed signal for each time point</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build the event model with seed as a covariate</span></span>
<span><span class="va">emodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmridesign/reference/event_model.html" class="external-link">event_model</a></span><span class="op">(</span></span>
<span>  <span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmridesign/reference/covariate.html" class="external-link">covariate</a></span><span class="op">(</span><span class="va">seed</span>, data <span class="op">=</span> <span class="va">cov_data</span>, prefix <span class="op">=</span> <span class="st">"seed"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">event_data</span>,</span>
<span>  block <span class="op">=</span> <span class="op">~</span> <span class="va">run</span>,</span>
<span>  sampling_frame <span class="op">=</span> <span class="va">sframe</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reuse our baseline model from above</span></span>
<span><span class="va">bmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmridesign/reference/baseline_model.html" class="external-link">baseline_model</a></span><span class="op">(</span></span>
<span>  basis <span class="op">=</span> <span class="st">"bs"</span>, </span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>, </span>
<span>  sframe <span class="op">=</span> <span class="va">sframe</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Update the dataset with our modified data that includes the network signal</span></span>
<span><span class="va">dset_modified</span> <span class="op">&lt;-</span> <span class="va">dset</span></span>
<span><span class="va">dset_modified</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">Y</span></span>
<span></span>
<span><span class="co"># Combine event and baseline models with the dataset</span></span>
<span><span class="va">fmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fmri_model.html">fmri_model</a></span><span class="op">(</span><span class="va">emodel</span>, <span class="va">bmodel</span>, <span class="va">dset_modified</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the connectivity GLM across all voxels</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fmri_lm.html">fmri_lm</a></span><span class="op">(</span></span>
<span>  <span class="va">fmodel</span>,</span>
<span>  dataset <span class="op">=</span> <span class="va">dset_modified</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>With the model fitted, we can now extract the connectivity
statistics. The t-statistic for the seed regressor at each voxel tells
us how strongly that voxel’s activity relates to the seed after
accounting for drift.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find the seed coefficient in our design matrix</span></span>
<span><span class="va">design_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmridesign/reference/design_matrix.html" class="external-link">design_matrix</a></span><span class="op">(</span><span class="va">fmodel</span><span class="op">)</span></span>
<span><span class="va">seed_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"seed"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">design_mat</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">seed_cols</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"No seed column found in design matrix"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">seed_col_name</span> <span class="op">&lt;-</span> <span class="va">seed_cols</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">seed_col_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">design_mat</span><span class="op">)</span> <span class="op">==</span> <span class="va">seed_col_name</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract connectivity statistics</span></span>
<span><span class="va">all_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stats.html">stats</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"estimates"</span><span class="op">)</span></span>
<span><span class="va">t_seed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">all_stats</span><span class="op">[</span><span class="va">seed_col_idx</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Also get p-values for significance testing</span></span>
<span><span class="va">all_pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/p_values.html">p_values</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"estimates"</span><span class="op">)</span></span>
<span><span class="va">p_seed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">all_pvals</span><span class="op">[</span><span class="va">seed_col_idx</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check the distribution of our connectivity map</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">t_seed</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;  0.9319  0.9319  0.9319  0.9319  0.9319  0.9319</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="validating-the-results">Validating the Results<a class="anchor" aria-label="anchor" href="#validating-the-results"></a>
</h2>
<p>Since we know which voxels belong to our simulated network, we can
check whether our connectivity analysis successfully recovered them.
Voxels in the network should show significantly higher connectivity
statistics than background voxels.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean_abs_t_network</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">t_seed</span><span class="op">[</span><span class="va">net_idx</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mean_abs_t_background</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">t_seed</span><span class="op">[</span><span class="op">-</span><span class="va">net_idx</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mean_abs_t_network <span class="op">=</span> <span class="va">mean_abs_t_network</span>, mean_abs_t_background <span class="op">=</span> <span class="va">mean_abs_t_background</span><span class="op">)</span></span>
<span><span class="co">#&gt;    mean_abs_t_network mean_abs_t_background </span></span>
<span><span class="co">#&gt;                   NaN             0.9319114</span></span></code></pre></div>
<p>The network voxels show substantially stronger connectivity with the
seed, confirming that our method successfully identifies functionally
connected regions.</p>
</div>
<div class="section level2">
<h2 id="visualizing-the-connectivity-map">Visualizing the Connectivity Map<a class="anchor" aria-label="anchor" href="#visualizing-the-connectivity-map"></a>
</h2>
<p>A histogram of the t-statistics reveals the distribution of
connectivity strengths across the brain. The red lines indicate the
range of connectivity values within our known network, demonstrating
clear separation from the background noise.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Clean data for visualization</span></span>
<span><span class="va">t_seed_clean</span> <span class="op">&lt;-</span> <span class="va">t_seed</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">t_seed</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">net_idx_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">net_idx</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">t_seed</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t_seed_clean</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">t_seed_clean</span>, breaks <span class="op">=</span> <span class="fl">40</span>, col <span class="op">=</span> <span class="st">"gray"</span>, </span>
<span>       main <span class="op">=</span> <span class="st">"Seed-based Connectivity Map"</span>, </span>
<span>       xlab <span class="op">=</span> <span class="st">"t-statistic"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">net_idx_clean</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">q_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">t_seed</span><span class="op">[</span><span class="va">net_idx_clean</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">q_vals</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Network 10th/90th percentile"</span><span class="op">)</span>, </span>
<span>           lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="functional_connectivity_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="extending-to-real-data">Extending to Real Data<a class="anchor" aria-label="anchor" href="#extending-to-real-data"></a>
</h2>
<p>The approach demonstrated here with simulated data translates
directly to real fMRI analyses. When working with actual data, you would
start by extracting the seed time series from your region of interest,
perhaps averaging across voxels within an anatomically or functionally
defined ROI.</p>
<p>For a more complete analysis, you might include additional nuisance
regressors such as motion parameters, physiological signals, or global
signal regression. The fmrireg framework makes it straightforward to add
these through the <code>nuisance_list</code> parameter in
<code><a href="https://bbuchsbaum.github.io/fmridesign/reference/baseline_model.html" class="external-link">baseline_model()</a></code>. You might also apply temporal filtering
to focus on specific frequency bands of interest.</p>
<p>For whole-brain connectivity mapping, this voxelwise approach
efficiently identifies all regions showing significant functional
coupling with your seed. Alternatively, you could perform ROI-to-ROI
connectivity by repeating the analysis with multiple seed regions and
assembling the results into a connectivity matrix.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This vignette has demonstrated how fmrireg’s flexible GLM framework
extends naturally to functional connectivity analysis. By treating the
seed time series as an experimental regressor rather than computing
simple correlations, we gain the ability to control for confounds and
obtain proper statistical inference. The same design matrix and model
fitting infrastructure used for task-based fMRI analysis seamlessly
handles connectivity studies, highlighting the versatility of the
fmrireg package.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/bbuchsbaum" class="external-link">Bradley Buchsbaum</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
